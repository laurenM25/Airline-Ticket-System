<!DOCTYPE html>
<html>

<head>
    <title>Flights taken by Customer</title>
    <link rel="stylesheet" href="static/general.css">
</head>

<body>
    <div class="topBar">
        <div class="left-top"></div>
        <div class="center-top">
            <span class="webpage-title">Air Ticket Reservation </span>
        </div>
        <div class="right-top">
            <span class="username">Welcome {{username}}</span>
            <a class='logout-link' href="/logout">log out</a>
        </div>
    </div>
    <div class="sideNav">
        <h3>Tools</h3>
        {% if usertype %}
        {% if usertype == "customer" %}
        <a class='page-link' href="/browseFlights">Browse Flights</a>
        <a class='page-link' href="/purchasedFlights">View purchased flights</a>
        <a class='page-link' href="/spendingStats">View spending stats</a>
        {% endif %}

        {% if usertype == "agent" %}
        <a class='page-link' href="/purchasedFlightsA">View flights purchased for clients</a>
        <a class='page-link' href="/browseFlightsA">Browse flights</a>
        <a class='page-link' href="/analyticsA">Analytics</a>
        {% endif %}

        {% if usertype == "airline_staff" %}
        <a class='page-link' href="/upcomingFlightsStaff">View upcoming flights for your airline</a>
        <a class='page-link' href="/passengerList">Check passenger list by flight number</a>
        <a class='page-link' href="/customersFlights">Look up flights taken by a customer</a>
        <a class='page-link' href="/analyticsStaff">Analytics</a>
        {% endif %}

        {% endif %}

        {% if specialperm %}
        {% if "admin" in specialperm %}
        <h3>Admin Tools</h3>
        <a class='page-link' href="/addAirport">Add new airport</a>
        <a class='page-link' href="/addAirplane">Add new airplane</a>
        <a class='page-link' href="/createFlight">Create flight</a>
        <a class='page-link' href="/assignAgent">Assign agent to airline</a>
        {% endif %}

        {% if "operator" in specialperm %}
        <h3>Operator Tools</h3>
        <a class='page-link' href="/updateStatus">Update flight status</a>
        {% endif %}
        {% endif %}
    </div>

    <div class="main-content">
        <H3>Flights taken by customer:</H3>
        <!--create drop down with cust_list to provide new options for lookup. add javascript, etc.-->
        <label for="customer-select">Select Customer:</label>
        <select id="customer-select">
            {% for cust in cust_list %}
            <option value="{{ cust }}" {% if cust==cur_cust %}selected{% endif %}>{{ cust }}</option>
            {% endfor %}
        </select>

        <table id="myTable">
            <thead>
                <tr>
                    {% for col in cols %}
                    <th>{{ col }}</th>
                    {% endfor %}
                </tr>
            </thead>

            <tbody>
                {% for row in table %}
                <tr>
                    {% for item in row %}
                    <td>{{ item }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!--for dynamic table (detect changes to dropdown)-->
    <script>
        document.getElementById("customer-select").addEventListener("change", function () {
            const selectedCustomer = this.value;

            // Make an AJAX request to the backend
            fetch(`/customersFlightsData?customer_email=${encodeURIComponent(selectedCustomer)}`)
                .then(response => response.json())
                .then(data => {
                    // Rebuild the table body
                    const table = document.getElementById("myTable");
                    const tbody = table.getElementsByTagName("tbody")[0];
                    tbody.innerHTML = ""; // clear old rows

                    data.flights.forEach(row => {
                        const tr = document.createElement("tr");
                        row.forEach(cell => {
                            const td = document.createElement("td");
                            td.textContent = cell;
                            tr.appendChild(td);
                        });
                        tbody.appendChild(tr);
                    });
                })
                .catch(error => console.error("Error fetching flights:", error));
        });
    </script>
</body>

</html>